<!-- Фильтр по диапазону студентов -->
<form [formGroup]="filterForm" class="filter-form global-filter">
  <label>
    Студент от:
    <input
      type="number"
      formControlName="from"
      (keydown)="preventNonNumeric($event)"
    />
  </label>
  <label>
    до:
    <input
      type="number"
      formControlName="to"
      (keydown)="preventNonNumeric($event)"
    />
  </label>

  <div class="error-messages" *ngIf="filterForm.errors?.['rangeInvalid']">
    Значение "до" должно быть больше или равно "от"
  </div>

  <div class="error-messages" *ngFor="let field of ['from', 'to']">
    <ng-container
      *ngIf="filterForm.get(field)?.invalid && filterForm.get(field)?.touched"
    >
      <span *ngIf="filterForm.get(field)?.errors?.['required']"
        >Обязательное поле</span
      >
      <span *ngIf="filterForm.get(field)?.errors?.['min']"
        >Минимальное значение 1</span
      >
      <span *ngIf="filterForm.get(field)?.errors?.['pattern']"
        >Только цифры</span
      >
    </ng-container>
  </div>
</form>

<!-- Студенты -->
<button (click)="exportStudentsByDisciplineExcel()">Экспорт в Excel</button>

<div class="card">
  <h3>Сравнительная таблица студентов</h3>
  <div class="table-wrapper">
    <table class="results-table">
      <thead>
        <tr>
          <th rowspan="2">Студент</th>
          <ng-container *ngFor="let discipline of uniqueDisciplines">
            <th [attr.colspan]="getSkillsForDiscipline(discipline).length">
              {{ discipline }} (Средний: {{
              getAverageScoreForDiscipline(discipline) }}%)
            </th>
          </ng-container>
          <th rowspan="2">Среднее по студенту</th>
        </tr>
        <tr>
          <ng-container *ngFor="let discipline of uniqueDisciplines">
            <ng-container
              *ngFor="let skill of getSkillsForDiscipline(discipline)"
            >
              <th>{{ skill.name }} ({{ skill.avg }}%)</th>
            </ng-container>
          </ng-container>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let student of filteredStudents">
          <td>{{ student }}</td>
          <ng-container *ngFor="let discipline of uniqueDisciplines">
            <ng-container
              *ngFor="let skill of getSkillsForDiscipline(discipline)"
            >
              <td>
                {{ getScoreForStudentSkill(student, skill.name) !== null ?
                getScoreForStudentSkill(student, skill.name) + "%" : "-" }}
              </td>
            </ng-container>
          </ng-container>
          <td>{{ getAverageScoreForStudent(student) }}%</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
