<div class="results-container">
  <h2 class="title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤</h2>

  <!-- –í–∫–ª–∞–¥–∫–∏ -->
  <div class="tabs">
    <button
      class="tab"
      [class.active]="activeTab === 'all'"
      (click)="setActiveTab('all')"
    >
      –í—Å–µ
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'students'"
      (click)="setActiveTab('students')"
    >
      –°—Ç—É–¥–µ–Ω—Ç—ã
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'skills'"
      (click)="setActiveTab('skills')"
    >
      –î–∏—Å—Ü–∏–ø–ª–∏–Ω—ã
    </button>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞ "–í—Å–µ" -->
  <div *ngIf="activeTab === 'all'">
    <div *ngIf="isLoading" class="loading">
      <span class="spinner"></span> –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
    </div>

    <table *ngIf="!isLoading && results.length > 0" class="results-table">
      <thead>
        <tr>
          <th (click)="sortBy('sessionName')">–°–µ—Å—Å–∏—è</th>
          <th (click)="sortBy('skillName')">–ù–∞–≤—ã–∫</th>
          <th (click)="sortBy('studentId')">–°—Ç—É–¥–µ–Ω—Ç</th>
          <th (click)="sortBy('teacherName')">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
          <th (click)="sortBy('score')">–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
          <th (click)="sortBy('resultDate')">–î–∞—Ç–∞</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let result of results">
          <td>{{ result.sessionName }}</td>
          <td>{{ result.skillName }}</td>
          <td>{{ result.studentId }}</td>
          <td>{{ result.teacherName }}</td>
          <td>
            <span
              class="score"
              [ngClass]="{
                'high-score': result.score >= 75,
                'mid-score': result.score >= 50 && result.score < 75,
                'low-score': result.score < 50
              }"
            >
              {{ result.score }}%
            </span>
          </td>
          <td>{{ result.resultDate | date : "dd.MM.yyyy" }}</td>
          <td>
            <button class="delete-btn" (click)="deleteResult(result)">
              –£–¥–∞–ª–∏—Ç—å
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <button class="export-btn" (click)="exportToExcel()">
      üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
    </button>
    <div *ngIf="!isLoading && results.length === 0" class="empty">
      –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    </div>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞ "–°—Ç—É–¥–µ–Ω—Ç—ã" -->
  <div *ngIf="activeTab === 'students'" class="students-tab">
    <div class="students-list">
      <h3>–°—Ç—É–¥–µ–Ω—Ç—ã</h3>
      <ul>
        <li
          *ngFor="let student of uniqueStudents"
          (click)="selectStudent(student)"
          [class.active]="student === selectedStudentId"
        >
          {{ student }}
        </li>
      </ul>
    </div>

    <div class="student-results" *ngIf="selectedStudentId">
      <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ç—É–¥–µ–Ω—Ç–∞ {{ selectedStudentId }}</h3>
      <table class="results-table">
        <thead>
          <tr>
            <th>–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞</th>
            <th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
            <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
            <th>–î–∞—Ç–∞</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let res of getResultsForSelectedStudent()">
            <td>{{ res.skillName }}</td>
            <td>{{ res.teacherName }}</td>
            <td>
              <span
                class="score"
                [ngClass]="{
                  'high-score': res.score >= 75,
                  'mid-score': res.score >= 50 && res.score < 75,
                  'low-score': res.score < 50
                }"
              >
                {{ res.score }}%
              </span>
            </td>
            <td>{{ res.resultDate | date : "dd.MM.yyyy" }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞ "–î–∏—Å—Ü–∏–ø–ª–∏–Ω—ã" -->
  <div *ngIf="activeTab === 'skills'" class="tab-content">
    <div class="skills-list">
      <div
        class="skill-card"
        *ngFor="let skill of uniqueSkills"
        (click)="selectSkill(skill)"
        [class.active]="skill === selectedSkill"
      >
        <h4>{{ skill }}</h4>
        <p>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: {{ getAverageScoreForSkill(skill) }}%</p>
      </div>
    </div>

    <div class="skill-results" *ngIf="selectedSkill">
      <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ "{{ selectedSkill }}"</h3>
      <table class="results-table">
        <thead>
          <tr>
            <th>–°—Ç—É–¥–µ–Ω—Ç</th>
            <th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
            <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
            <th>–î–∞—Ç–∞</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let res of getResultsForSelectedSkill()">
            <td>{{ res.studentId }}</td>
            <td>{{ res.teacherName }}</td>
            <td>
              <span
                class="score"
                [ngClass]="{
                  'high-score': res.score >= 75,
                  'mid-score': res.score >= 50 && res.score < 75,
                  'low-score': res.score < 50
                }"
              >
                {{ res.score }}%
              </span>
            </td>
            <td>{{ res.resultDate | date : "dd.MM.yyyy" }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="student-placeholder" *ngIf="!selectedSkill">
      <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</p>
    </div>
  </div>
</div>
