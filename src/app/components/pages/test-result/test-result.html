<div class="tabs">
  <button [class.active]="activeTab === 'all'" (click)="setActiveTab('all')">
    Все
  </button>
  <button
    [class.active]="activeTab === 'students'"
    (click)="setActiveTab('students')"
  >
    Студенты
  </button>
  <button
    [class.active]="activeTab === 'skills'"
    (click)="setActiveTab('skills')"
  >
    Навыки
  </button>
  <button
    [class.active]="activeTab === 'disciplines'"
    (click)="setActiveTab('disciplines')"
  >
    Дисциплины
  </button>
</div>

<!-- Все результаты -->
<div id="all-tab" *ngIf="activeTab === 'all'" class="tab-panel">
  <form [formGroup]="filterForm" class="filter-form">
    <label>Студент от: <input type="number" formControlName="from" /></label>
    <label>до: <input type="number" formControlName="to" /></label>
  </form>

  <table *ngIf="!isLoading && filteredResults.length" class="results-table">
    <thead>
      <tr>
        <th (click)="sortBy('sessionName')" *ngIf="!sessionId">Сессия</th>
        <th (click)="sortBy('disciplineName')">Дисциплина</th>
        <th (click)="sortBy('skillName')">Навык</th>
        <th (click)="sortBy('studentId')">Студент</th>
        <th (click)="sortBy('teacherName')">Преподаватель</th>
        <th (click)="sortBy('score')">Результат</th>
        <th (click)="sortBy('resultDate')">Дата</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let r of filteredResults">
        <td *ngIf="!sessionId">{{ r.sessionName }}</td>
        <td>{{ r.disciplineName }}</td>
        <td>{{ r.skillName }}</td>
        <td>{{ r.studentId }}</td>
        <td>{{ r.teacherName }}</td>
        <td>{{ r.score }}%</td>
        <td>{{ r.resultDate | date : "dd.MM.yyyy" }}</td>
      </tr>
    </tbody>
  </table>
  <div *ngIf="!isLoading && filteredResults.length === 0" class="empty">
    Нет результатов
  </div>
</div>

<!-- Студенты -->
<div *ngIf="activeTab === 'students'" class="tab-panel">
  <div class="student-list">
    <button
      *ngFor="let s of uniqueStudents"
      (click)="selectedStudentId = s"
      [class.active]="selectedStudentId === s"
    >
      {{ s }}
    </button>
  </div>
  <div *ngIf="selectedStudentId" class="card">
    <h3>Результаты студента {{ selectedStudentId }}</h3>
    <table>
      <thead>
        <tr>
          <th>Дисциплина</th>
          <th>Навык</th>
          <th>Результат</th>
          <th>Дата</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of getResultsForSelectedStudent()">
          <td>{{ r.disciplineName }}</td>
          <td>{{ r.skillName }}</td>
          <td>{{ r.score }}%</td>
          <td>{{ r.resultDate | date : "dd.MM.yyyy" }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Навыки -->
<div *ngIf="activeTab === 'skills'" class="tab-panel">
  <div class="skill-list">
    <div *ngFor="let skill of uniqueSkills" class="skill-item">
      <span
        (click)="selectedSkill = skill"
        [class.active]="selectedSkill === skill"
        >{{ skill }}</span
      >
      <span class="avg">Средний: {{ getAverageScoreForSkill(skill) }}%</span>
    </div>
  </div>
  <div *ngIf="selectedSkill" class="card">
    <h3>Результаты по навыку {{ selectedSkill }}</h3>
    <table>
      <thead>
        <tr>
          <th>Студент</th>
          <th>Результат</th>
          <th>Дата</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of getResultsForSelectedSkill()">
          <td>{{ r.studentId }}</td>
          <td>{{ r.score }}%</td>
          <td>{{ r.resultDate | date : "dd.MM.yyyy" }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Дисциплины -->
<div *ngIf="activeTab === 'disciplines'" class="tab-panel">
  <div class="discipline-list">
    <div *ngFor="let d of uniqueDisciplines" class="discipline-item card">
      <span class="name">{{ d }}</span>
      <span class="avg">Средний: {{ getAverageScoreForDiscipline(d) }}%</span>
    </div>
  </div>
</div>
